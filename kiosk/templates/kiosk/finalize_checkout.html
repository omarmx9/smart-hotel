{% extends 'base.html' %}

{% block title %}Check-Out - Smart Hotel{% endblock %}

{% block content %}
<div class="complete-page">
	<div class="card p-4 p-md-5">
		<div class="success-header">
			<div class="icon-box icon-box-lg icon-success">
				<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor" viewBox="0 0 16 16"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/></svg>
			</div>
			<h1 data-i18n="checkout_title">Check-Out</h1>
			<p class="text-muted mb-0" data-i18n="checkout_message">Thank you for staying with us. We hope to see you again!</p>
		</div>
		
		<div class="row g-3 mb-4">
			<div class="col-6 col-md-3">
				<div class="info-card">
					<small data-i18n="reservation">Reservation</small>
					<strong>{{ reservation.reservation_number|default:"N/A" }}</strong>
				</div>
			</div>
			<div class="col-6 col-md-3">
				<div class="info-card">
					<small data-i18n="guest">Guest</small>
					<strong>{% if reservation.guest %}{{ reservation.guest.first_name }} {{ reservation.guest.last_name }}{% else %}Guest{% endif %}</strong>
				</div>
			</div>
			<div class="col-6 col-md-3">
				<div class="info-card">
					<small data-i18n="room">Room</small>
					<strong>{{ room_number|default:"---" }}</strong>
				</div>
			</div>
			<div class="col-6 col-md-3">
				<div class="info-card">
					<small data-i18n="people">People</small>
					<strong>{{ reservation.people_count|default:"1" }}</strong>
				</div>
			</div>
		</div>
	</div>

	<!-- Keycard Return Section - Only shown for check-out -->
	<div class="card p-4 p-md-5 mt-4">
		<div class="d-flex align-items-center justify-content-center gap-3 mb-4">
			<div class="icon-box icon-warning">
				<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16"><path d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2zm8.93 4.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/></svg>
			</div>
			<h2 class="mb-0" data-i18n="return_keycards_title">Return Your Keycards</h2>
		</div>

		{% if reservation.keycards_submitted %}
		<div class="alert alert-success d-flex align-items-center gap-2">
			<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/></svg>
			<span data-i18n="keycards_submitted">Keycards submitted successfully. Thank you!</span>
		</div>
		{% else %}
		<div class="p-4 rounded mb-4" style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, transparent 100%); border: 1px solid rgba(245, 158, 11, 0.2);">
			<div class="d-flex align-items-center gap-3 mb-3">
				<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="text-warning" viewBox="0 0 16 16"><path d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2zm4 4h8v1H4V6zm0 2.5h8v1H4v-1zm0 2.5h5v1H4v-1z"/></svg>
				<div>
					<strong data-i18n="keycard_return_instruction">Please insert all keycards into the slot below</strong>
					<p class="mb-0 mt-1 text-muted" data-i18n="keycard_count_info">Number of keycards issued: {{ reservation.keycard_count|default:"1" }}</p>
				</div>
			</div>
			
			<div class="keycard-drop-zone text-center p-4 border border-2 border-dashed rounded" style="border-color: var(--brand-color) !important;">
				<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" class="text-muted mb-2" viewBox="0 0 16 16"><path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/><path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/></svg>
				<p class="mb-0" data-i18n="keycard_slot">← Keycard Slot</p>
			</div>
		</div>
		
		<form method="post" action="{% url 'kiosk:submit_keycards' reservation.id %}">
			{% csrf_token %}
			<div class="d-grid">
				<button type="submit" class="btn btn-primary btn-lg" data-i18n="confirm_keycard_return">
					Confirm Keycard Return
				</button>
			</div>
		</form>
		{% endif %}
		
		{% if 'keycard' in access_method %}
		<div class="mt-3 text-center">
			<a href="{% url 'kiosk:report_stolen_card' reservation.id %}" class="btn btn-outline-danger btn-sm">
				<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 6px;">
					<path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
				</svg>
				<span data-i18n="report_lost_stolen">Report Lost/Stolen Card</span>
			</a>
		</div>
		{% endif %}
	</div>

	<!-- Payment Section -->
	<div class="card p-4 p-md-5 mt-4">
		<h3 data-i18n="payment_summary">Payment Summary</h3>
		
		{% if reservation.paid %}
		<div class="alert alert-success d-flex align-items-center gap-2">
			<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/></svg>
			<span data-i18n="payment_complete">Payment complete. Your invoice will be sent to your email.</span>
		</div>
		{% else %}
		<div class="alert alert-warning d-flex align-items-center gap-2">
			<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16"><path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/></svg>
			<span data-i18n="payment_pending">Payment pending. Any remaining balance will be charged to your card on file.</span>
		</div>
		
		<div class="row g-3 mb-3">
			<div class="col-6">
				<small class="text-muted" data-i18n="room_charges">Room Charges</small>
				<div class="h5 mb-0">€{{ reservation.room_total|default:"0.00" }}</div>
			</div>
			<div class="col-6">
				<small class="text-muted" data-i18n="additional_charges">Additional Charges</small>
				<div class="h5 mb-0">€{{ reservation.extras_total|default:"0.00" }}</div>
			</div>
		</div>
		<hr>
		<div class="d-flex justify-content-between align-items-center">
			<strong data-i18n="total_due">Total Due:</strong>
			<span class="h4 mb-0 text-primary">€{{ reservation.amount_due|default:"0.00" }}</span>
		</div>
		{% endif %}
	</div>

	<div class="text-center mt-4">
		<a href="{% url 'kiosk:advertisement' %}" class="btn btn-outline-secondary btn-lg" data-i18n="finish">
			Finish
		</a>
	</div>

	<div class="text-center mt-3">
		<p class="text-muted" data-i18n="feedback_prompt">We value your feedback! Please rate your stay on the next screen.</p>
	</div>
</div>
{% endblock %}
